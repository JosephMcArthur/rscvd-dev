P._editStyle="<style>.PChanged { border-color: yellow; box-shadow: 1px 1px 1px 1px yellow; } .PSaved { border-color: green; box-shadow: 1px 1px 1px 1px green; } .PError { border-color: red; box-shadow: 1px 1px 1px 1px red; } </style>",P._editTimeout,P._editRecord,P.edit=function(e){var t,o,r,n,i;null==e&&(e={}),(r=P(".PSave"))&&(e.goto||((o=null==(o=P.get(r,"goto"))?P.get(r,"href"):o)&&(e.goto=o),e.goto||(e.goto="#PThanks",null==e.clear&&(e.clear=!0),null==e.hide&&(e.hide=!1))));try{(n=P(".PForm"))&&(t=(n=Array.isArray(n)||HTMLCollection.prototype.isPrototypeOf(n)||NodeList.prototype.isPrototypeOf(n)?n[0]:n).closest("form"),null==e.url&&(e.url=P.get(t,"action")),null==e.method&&(e.method=P.get(t,"method")))}catch(t){}return null==e.url&&(e.url=window.location.pathname.replace(".html","")),!1!==e.style&&P.append("body",null!=(i=e.style)?i:P._editStyle),null!=e.record?P._editRecord=e.record:P.save(void 0,!1),i=function(t){t=t.target;if(null!=P._editTimeout&&clearTimeout(P._editTimeout),P.class(t,"PError",!1),P.class(t,"PSaved",!1),P.class(t,"PChanged"),!P(".PSave"))return P._editTimeout=setTimeout(function(){return P.save(void 0,e)},1500)},P(".PSave")?P.on("click",".PSave",function(t){return P.save(void 0,e,t)}):!1!==e.watch?(P.on("change",".PForm",i),P.on("keyup",".PForm",i)):void 0},P.save=function(t,e,o){var r;if("function"!=typeof P.validate||P.validate()){if(console.log("saving"),P.show(".PLoading"),null!=o){try{P.attr(o.target,"_content",P.html(o.target)),P.html(o.target,"Submitting...")}catch(t){}try{o.preventDefault()}catch(t){}}null==t&&(null==P._editRecord&&(P._editRecord={}),P(".PSaved",function(t){return P.class(t,"PSaved",!1)}),".PChanged"!==(r=!1===e?".PForm":".PChanged")||P(r)||(r=".PForm"),P(r,function(t){var e,o=P.get(t,"PKey");if(null==o&&(o=P.get(t,"id")),"radio"===t.getAttribute("type"))return null==(e=P._editRecord)[o]&&(e[o]=[]),P._editRecord[o].push(P.get(t));if(null!==(t=P.get(t)))return P._editRecord[o]=t;try{return delete P._editRecord[o]}catch(t){}}),t=P._editRecord),!1!==e&&(null==t._id&&(t._id=P._newid),P.ajax(e.url,{method:e.method,data:t,success:function(t){try{P.html(o.target,P.attr(o.target,"_content"))}catch(t){}if(P.hide(".PLoading"),!P._newid&&-1!==window.location.search.indexOf("?new")||-1!==window.location.search.indexOf("&new")){P._newid=t._id;try{window.history.replaceState("","",window.location.pathname.replace(".html","/"+t._id+".html?edit"))}catch(t){}}if(P(".PChanged",function(t){return P.class(t,"PChanged",!1),P.class(t,"PSaved")}),e.clear)try{P.set(".PForm","")}catch(t){}return e.hide&&null!=o&&P.hide(o.target.closest("form")),"function"==typeof e.goto?e.goto():"string"==typeof e.goto?e.goto.startsWith("#")||e.goto.startsWith(".")&&P(e.goto)?(P.hide(".PSave"),P.show(e.goto),setTimeout(function(){return P.hide(e.goto),P.show(".PSave")},1e4)):window.location=e.goto:void 0},error:function(t){try{P.html(o.target,P.attr(o.target,"_content"))}catch(t){}return P.hide(".PLoading"),P.show(".PError"),P(".PChanged",function(t){return P.class(t,"PChanged",!1),P.class(t,"PError")})}}))}return!1},P.validate=function(t){var e;return null==(t=null==t&&(e=P(".PForm"))?(e=P.list(e)[0]).closest("form"):t)||(t=P.list(t)[0]).checkValidity()};