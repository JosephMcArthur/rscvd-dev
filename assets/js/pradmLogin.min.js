null==P.service&&(P.service=void 0),P.oauthRedirectUri=void 0,P.oauthGoogleClientId=void 0,P.account=void 0,P.token=function(o){try{o.preventDefault()}catch(o){}return P.cookie(!1),(o=P.val("#PEmail"))?(P.hide(".PEmail"),P.show(".PLoading"),P.show(".PToken"),o={success:function(o){return P.hide(".PLoading"),P.focus("#PToken"),P._loggingin=setInterval(function(){if(P.loggedin())return P.loginSuccess()},2e3)},data:{email:o,url:window.location.protocol+"//"+window.location.host+window.location.pathname,service:P.service}},P.ajax("/auth/token",o)):(P.css("#PEmail","border-color","#f04717"),void P.focus("#PEmail"))},P.loginSuccess=function(o){if(P._loggingin&&(clearInterval(P._loggingin),delete P._loggingin),P.hide(".PLogin"),P.hide(".PLoading"),P.hide(".PToken"),"object"==typeof o&&(P.account=o,P.cookie(o)),null!=(o=P.account)&&o.email&&P(".PWelcome")&&(o=(o=P.html(".PWelcome")).length?o+" "+P.account.email.split("@")[0]:P.account.email,P.html(".PWelcome",o),P.show(".PWelcome")),P.loginNext||-1===window.location.search.indexOf("next=")?!P.loginNext&&window.location.search.startsWith("?next")&&(P.loginNext=!0):P.loginNext=decodeURIComponent(window.location.search.split("next=")[1].split("&")[0]),P.loginNext)return!0===P.loginNext?location.reload():window.location=P.loginNext;try{P.show(".PLogout"),P.on("click","#PLogout",P.logout)}catch(o){}try{if("function"==typeof P.afterLogin)return P.afterLogin()}catch(o){}},P.loginError=function(o,e){return console.log("Login error"),console.log(o),console.log(e),P._loggingin&&(clearInterval(P._loggingin),delete P._loggingin),P.cookie(!1),P.account=void 0,P.hide(".PLoading"),P.hide(".PToken"),P.set("#PEmail",""),P.set("#PEmail","placeholder","error, enter your email to try again"),P.show(".PEmail"),P.show(".PLogin")},P.login=function(o){var e,t,i,n,a,l,c;try{o.preventDefault()}catch(o){}if(i={success:P.loginSuccess,error:P.loginError,data:{service:P.service}},o=P.val("#PToken"),-1!==window.location.hash.indexOf("access_token=")){for(n in i.data.oauth={},a=window.location.hash.replace("#","").split("&"))[e,c]=a[n].split("="),i.data.oauth[e]=c;t=P.cookie("poauth"),P.cookie("poauth",!1)}else if(8===window.location.hash.replace("#","").length){i.data.token=window.location.hash.replace("#","");try{window.history.pushState("","",window.location.pathname)}catch(o){}}else"string"==typeof o&&8===o.length?i.data.token=o:(l=P.loggedin())&&(i.data.email=l.email,i.data.resume=l.resume);if(i.data.email&&i.data.resume||i.data.hash||i.data.token||(null!=(l=i.data.oauth)?l.state:void 0)===(null!=t?t.state:void 0))return P.hide(".PEmail"),P.hide(".PToken"),P.show(".PLoading"),P.ajax("/auth",i)},P.loggedin=function(){var o;return(o=P.cookie())&&"object"==typeof o&&"{}"!==JSON.stringify(o)&&(P.account=o),P.account},P.logout=function(o){try{o.preventDefault()}catch(o){}if(P.show(".PLoading"),o=P.loggedin())return P.ajax("/auth/logout?apikey="+o.apikey,{success:function(){if(P.account=void 0,P.cookie(!1),P.hide(".PLoading"),!0===P.loginNext)return location.reload();if(P.loginNext)return window.location=P.loginNext;if("function"==typeof P.afterLogout)try{return P.afterLogout()}catch(o){}}})},P.requestPermission=function(){return P.hide(".PRequestPermission"),P.show(".PRequestedPermission"),P.ajax("/auth/request")},P.ready(function(){var o,e,t;try{P.on("enter","#PEmail",P.token)}catch(o){}try{P.on("keyup","#PToken",function(o){if(8===P.val("#PToken").length)return P.login()})}catch(o){}try{P.on("click","#PRequestPermission",P.requestPermission)}catch(o){}try{P.val("#POauthGoogle").length&&P.oauthGoogleClientId&&(t=Math.random().toString(36).substring(2,8),o="https://accounts.google.com/o/oauth2/v2/auth?response_type=token&include_granted_scopes=true&scope=https://www.googleapis.com/auth/userinfo.email+https://www.googleapis.com/auth/userinfo.profile",o+="&state="+t+"&redirect_uri="+(null!=(e=P.oauthRedirectUri)?e:window.location.href.split("#")[0].split("?")[0])+"&client_id="+P.oauthGoogleClientId,P.set("#POauthGoogle","href",o),P.on("click","#POauthGoogle",function(){return P.cookie("poauth",{state:t},{expires:1})}))}catch(o){}if((o=P.loggedin())||"string"==typeof window.location.hash&&window.location.hash&&8===window.location.hash.replace("#","").length)return o&&(P.loginNext=void 0),P.login()});